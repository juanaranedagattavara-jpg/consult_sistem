---
phase: 02-professionals-services-calendar
plan: 22
type: execute
wave: 6
depends_on: ["02-16", "02-17", "02-18", "02-20", "02-21"]
files_modified:
  - src/app/(dashboard)/profesionales/page.tsx
  - src/app/(dashboard)/profesionales/[id]/page.tsx
  - src/app/(dashboard)/profesionales/nuevo/page.tsx
autonomous: true

must_haves:
  truths:
    - "Professionals page has toggle between table and cards"
    - "Can filter by active/inactive/all"
    - "New professional page with full form"
    - "Edit professional page with all sections"
  artifacts:
    - path: "src/app/(dashboard)/profesionales/page.tsx"
      provides: "Professionals list page"
    - path: "src/app/(dashboard)/profesionales/nuevo/page.tsx"
      provides: "New professional page"
    - path: "src/app/(dashboard)/profesionales/[id]/page.tsx"
      provides: "Edit professional page"
  key_links:
    - from: "src/app/(dashboard)/profesionales/page.tsx"
      to: "src/components/professionals/professional-table.tsx"
      via: "import ProfessionalTable"
      pattern: "import.*ProfessionalTable"
---

<objective>
Create professionals pages with list, create, and edit views.

Purpose: Admin manages professionals through dedicated pages - list with view toggle, create form, edit with all sections.
Output: Three pages for professionals CRUD with integrated components.
</objective>

<execution_context>
@C:\Users\juana\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\juana\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02-professionals-services-calendar/CONTEXT.md
@src/components/professionals/professional-table.tsx
@src/components/professionals/professional-cards.tsx
@src/components/professionals/professional-form.tsx
@src/components/professionals/schedule-editor.tsx
@src/components/professionals/calendar-selector.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create professionals list page</name>
  <files>src/app/(dashboard)/profesionales/page.tsx</files>
  <action>
Create src/app/(dashboard)/profesionales/page.tsx:

```tsx
"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";
import { Plus, LayoutGrid, LayoutList } from "lucide-react";

import { Button } from "@/components/ui/button";
import { Tabs, TabsList, TabsTrigger } from "@/components/ui/tabs";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";
import { useCurrentClinic } from "@/hooks/useCurrentClinic";
import { ProfessionalTable } from "@/components/professionals/professional-table";
import { ProfessionalCards } from "@/components/professionals/professional-cards";
import { Id } from "@/convex/_generated/dataModel";

type ViewMode = "table" | "cards";
type FilterMode = "all" | "active" | "inactive";

export default function ProfesionalesPage() {
  const { clinic, isLoading } = useCurrentClinic();
  const router = useRouter();

  const [viewMode, setViewMode] = useState<ViewMode>("table");
  const [filter, setFilter] = useState<FilterMode>("all");

  function handleEdit(professionalId: Id<"professionals">) {
    router.push(`/profesionales/${professionalId}`);
  }

  if (isLoading) {
    return (
      <div className="p-6 text-center text-muted-foreground">Cargando...</div>
    );
  }

  if (!clinic) {
    return (
      <div className="p-6 text-center text-muted-foreground">
        No se encontro la clinica
      </div>
    );
  }

  return (
    <div className="p-6 space-y-6">
      {/* Header */}
      <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
        <h1 className="text-2xl font-bold">Profesionales</h1>

        <div className="flex items-center gap-4">
          {/* Filter */}
          <Select value={filter} onValueChange={(v) => setFilter(v as FilterMode)}>
            <SelectTrigger className="w-[140px]">
              <SelectValue />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="all">Todos</SelectItem>
              <SelectItem value="active">Activos</SelectItem>
              <SelectItem value="inactive">Inactivos</SelectItem>
            </SelectContent>
          </Select>

          {/* View Toggle */}
          <Tabs value={viewMode} onValueChange={(v) => setViewMode(v as ViewMode)}>
            <TabsList className="grid w-[100px] grid-cols-2">
              <TabsTrigger value="table">
                <LayoutList className="h-4 w-4" />
              </TabsTrigger>
              <TabsTrigger value="cards">
                <LayoutGrid className="h-4 w-4" />
              </TabsTrigger>
            </TabsList>
          </Tabs>

          {/* Add Button */}
          <Button onClick={() => router.push("/profesionales/nuevo")}>
            <Plus className="h-4 w-4 mr-2" />
            Nuevo
          </Button>
        </div>
      </div>

      {/* Content */}
      {viewMode === "table" ? (
        <ProfessionalTable
          clinicId={clinic._id}
          onEdit={handleEdit}
          filter={filter}
        />
      ) : (
        <ProfessionalCards
          clinicId={clinic._id}
          onEdit={handleEdit}
          filter={filter}
        />
      )}
    </div>
  );
}
```
  </action>
  <verify>No TypeScript errors: `npx tsc --noEmit`</verify>
  <done>Professionals list page with view toggle and filter</done>
</task>

<task type="auto">
  <name>Task 2: Create new professional page</name>
  <files>src/app/(dashboard)/profesionales/nuevo/page.tsx</files>
  <action>
Create src/app/(dashboard)/profesionales/nuevo/page.tsx:

```tsx
"use client";

import { useRouter } from "next/navigation";
import { ArrowLeft } from "lucide-react";

import { Button } from "@/components/ui/button";
import { useCurrentClinic } from "@/hooks/useCurrentClinic";
import { ProfessionalForm } from "@/components/professionals/professional-form";

export default function NuevoProfesionalPage() {
  const { clinic, isLoading } = useCurrentClinic();
  const router = useRouter();

  if (isLoading) {
    return (
      <div className="p-6 text-center text-muted-foreground">Cargando...</div>
    );
  }

  if (!clinic) {
    return (
      <div className="p-6 text-center text-muted-foreground">
        No se encontro la clinica
      </div>
    );
  }

  return (
    <div className="p-6 space-y-6 max-w-2xl">
      {/* Header */}
      <div className="flex items-center gap-4">
        <Button variant="ghost" size="icon" onClick={() => router.back()}>
          <ArrowLeft className="h-5 w-5" />
        </Button>
        <h1 className="text-2xl font-bold">Nuevo Profesional</h1>
      </div>

      {/* Form */}
      <ProfessionalForm
        clinicId={clinic._id}
        onSuccess={() => router.push("/profesionales")}
        onCancel={() => router.back()}
      />
    </div>
  );
}
```
  </action>
  <verify>No TypeScript errors: `npx tsc --noEmit`</verify>
  <done>New professional page with form</done>
</task>

<task type="auto">
  <name>Task 3: Create edit professional page</name>
  <files>src/app/(dashboard)/profesionales/[id]/page.tsx</files>
  <action>
Create src/app/(dashboard)/profesionales/[id]/page.tsx:

```tsx
"use client";

import { useState, useCallback } from "react";
import { useRouter, useParams } from "next/navigation";
import { useQuery, useMutation } from "convex/react";
import { api } from "@/convex/_generated/api";
import { Id } from "@/convex/_generated/dataModel";
import { ArrowLeft } from "lucide-react";
import { toast } from "sonner";

import { Button } from "@/components/ui/button";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { useCurrentClinic } from "@/hooks/useCurrentClinic";
import { ProfessionalForm } from "@/components/professionals/professional-form";
import { ScheduleEditor } from "@/components/professionals/schedule-editor";
import { CalendarSelector } from "@/components/professionals/calendar-selector";

export default function EditarProfesionalPage() {
  const { clinic, isLoading: clinicLoading } = useCurrentClinic();
  const router = useRouter();
  const params = useParams();
  const professionalId = params.id as Id<"professionals">;

  const professional = useQuery(api.professionals.getWithServices, { professionalId });
  const updateProfessional = useMutation(api.professionals.update);

  const [activeTab, setActiveTab] = useState("datos");

  // Schedule change handler
  const handleScheduleChange = useCallback(async (schedule: unknown) => {
    try {
      await updateProfessional({
        professionalId,
        schedule: schedule as any,
      });
      toast.success("Horario actualizado");
    } catch (error) {
      toast.error("Error al guardar horario");
    }
  }, [professionalId, updateProfessional]);

  // Calendar change handler
  const handleCalendarChange = useCallback(async (calendarId: string | undefined) => {
    try {
      await updateProfessional({
        professionalId,
        calendarId,
      });
      toast.success("Calendario actualizado");
    } catch (error) {
      toast.error("Error al guardar calendario");
    }
  }, [professionalId, updateProfessional]);

  if (clinicLoading || professional === undefined) {
    return (
      <div className="p-6 text-center text-muted-foreground">Cargando...</div>
    );
  }

  if (!clinic || !professional) {
    return (
      <div className="p-6 text-center text-muted-foreground">
        No se encontro el profesional
      </div>
    );
  }

  return (
    <div className="p-6 space-y-6">
      {/* Header */}
      <div className="flex items-center gap-4">
        <Button variant="ghost" size="icon" onClick={() => router.push("/profesionales")}>
          <ArrowLeft className="h-5 w-5" />
        </Button>
        <div>
          <h1 className="text-2xl font-bold">{professional.name}</h1>
          <p className="text-muted-foreground">{professional.specialty}</p>
        </div>
      </div>

      {/* Tabs */}
      <Tabs value={activeTab} onValueChange={setActiveTab}>
        <TabsList>
          <TabsTrigger value="datos">Datos</TabsTrigger>
          <TabsTrigger value="horario">Horario</TabsTrigger>
          <TabsTrigger value="calendario">Calendar</TabsTrigger>
        </TabsList>

        <TabsContent value="datos" className="mt-6 max-w-2xl">
          <ProfessionalForm
            clinicId={clinic._id}
            professional={professional}
            onSuccess={() => toast.success("Cambios guardados")}
          />
        </TabsContent>

        <TabsContent value="horario" className="mt-6 max-w-3xl">
          <ScheduleEditor
            value={professional.schedule ?? null}
            onChange={handleScheduleChange}
            clinicSchedule={{
              open: clinic.hours.open,
              close: clinic.hours.close,
              lunch: clinic.hours.lunch,
              workDays: clinic.workDays,
            }}
          />
        </TabsContent>

        <TabsContent value="calendario" className="mt-6 max-w-2xl">
          <CalendarSelector
            professionalId={professional._id}
            professionalName={professional.name}
            calendarId={professional.calendarId ?? null}
            onChange={handleCalendarChange}
          />
        </TabsContent>
      </Tabs>
    </div>
  );
}
```
  </action>
  <verify>No TypeScript errors: `npx tsc --noEmit`</verify>
  <done>Edit professional page with tabs for all sections</done>
</task>

</tasks>

<verification>
1. All three pages exist and render correctly
2. `npx tsc --noEmit` succeeds
3. Navigation between pages works
</verification>

<success_criteria>
- List page: toggle between table/cards, filter by status
- New page: ProfessionalForm with back navigation
- Edit page: tabs for Datos, Horario, Calendar
- Schedule and calendar changes save automatically
- All pages use useCurrentClinic for context
</success_criteria>

<output>
After completion, create `.planning/phases/02-professionals-services-calendar/02-22-SUMMARY.md`
</output>
