---
phase: 02-professionals-services-calendar
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - convex/schema.ts
autonomous: true

must_haves:
  truths:
    - "Service categories table exists with clinicId, name, order"
    - "Services table exists with all required fields"
    - "Tables have proper indexes for efficient queries"
  artifacts:
    - path: "convex/schema.ts"
      provides: "serviceCategories and services tables"
      contains: "serviceCategories"
  key_links:
    - from: "convex/schema.ts:services"
      to: "convex/schema.ts:serviceCategories"
      via: "categoryId foreign key"
      pattern: "categoryId: v.id\\(\"serviceCategories\"\\)"
---

<objective>
Add serviceCategories and services tables to Convex schema.

Purpose: Backend data model for services CRUD - services are grouped by categories with ordering support.
Output: Schema.ts updated with two new tables and their indexes.
</objective>

<execution_context>
@C:\Users\juana\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\juana\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02-professionals-services-calendar/CONTEXT.md
@.planning/phases/02-professionals-services-calendar/02-RESEARCH.md
@convex/schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add serviceCategories and services tables to schema</name>
  <files>convex/schema.ts</files>
  <action>
Add two new tables to convex/schema.ts AFTER the profiles table definition:

```typescript
// Service Categories
serviceCategories: defineTable({
  clinicId: v.id("clinics"),
  name: v.string(),
  order: v.number(),
  createdAt: v.number(),
  updatedAt: v.number(),
})
  .index("by_clinic", ["clinicId"])
  .index("by_clinic_order", ["clinicId", "order"]),

// Services
services: defineTable({
  clinicId: v.id("clinics"),
  categoryId: v.id("serviceCategories"),
  name: v.string(),
  description: v.optional(v.string()),
  duration: v.number(), // minutes
  price: v.optional(v.number()),
  color: v.optional(v.string()),
  order: v.number(), // within category
  active: v.boolean(),
  createdAt: v.number(),
  updatedAt: v.number(),
})
  .index("by_clinic", ["clinicId"])
  .index("by_category", ["categoryId"])
  .index("by_clinic_active", ["clinicId", "active"]),
```

Fields explained:
- serviceCategories: Each clinic has its own categories (no predefined list)
- services.order: For drag-drop reordering within a category
- services.color: Optional hex color for calendar display
- services.active: Toggle without deletion

Do NOT modify existing tables (clinics, profiles).
  </action>
  <verify>
Run schema push to validate:
```bash
npx convex dev --once
```
Should succeed without schema validation errors.
  </verify>
  <done>Schema contains serviceCategories and services tables with proper indexes</done>
</task>

</tasks>

<verification>
1. `grep -A 20 "serviceCategories" convex/schema.ts` shows category table
2. `grep -A 25 "services:" convex/schema.ts` shows services table with categoryId
3. `npx convex dev --once` succeeds (schema valid)
</verification>

<success_criteria>
- serviceCategories table: clinicId, name, order, timestamps + by_clinic and by_clinic_order indexes
- services table: all fields from CONTEXT.md + by_clinic, by_category, by_clinic_active indexes
- Schema pushes successfully to Convex
</success_criteria>

<output>
After completion, create `.planning/phases/02-professionals-services-calendar/02-02-SUMMARY.md`
</output>
