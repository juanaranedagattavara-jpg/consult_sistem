---
phase: 02-professionals-services-calendar
plan: 14
type: execute
wave: 5
depends_on: ["02-04", "02-08"]
files_modified:
  - src/components/services/category-form.tsx
  - src/components/services/category-list.tsx
autonomous: true

must_haves:
  truths:
    - "Can create new service category"
    - "Can edit category name"
    - "Can delete empty category"
    - "Shows list of categories"
  artifacts:
    - path: "src/components/services/category-form.tsx"
      provides: "Category create/edit form"
      exports: ["CategoryForm"]
    - path: "src/components/services/category-list.tsx"
      provides: "Category list with CRUD actions"
      exports: ["CategoryList"]
  key_links:
    - from: "src/components/services/category-form.tsx"
      to: "convex/serviceCategories.ts"
      via: "useMutation"
      pattern: "useMutation.*serviceCategories"
---

<objective>
Create service category management components.

Purpose: Categories organize services - admin needs to create/edit/delete categories before adding services.
Output: CategoryForm and CategoryList components for managing service categories.
</objective>

<execution_context>
@C:\Users\juana\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\juana\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02-professionals-services-calendar/CONTEXT.md
@convex/serviceCategories.ts
@src/components/ui/dialog.tsx
@src/components/ui/form.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create category form component</name>
  <files>src/components/services/category-form.tsx</files>
  <action>
Create src/components/services/category-form.tsx:

```tsx
"use client";

import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { z } from "zod";
import { useMutation } from "convex/react";
import { api } from "@/convex/_generated/api";
import { Id } from "@/convex/_generated/dataModel";
import { toast } from "sonner";

import { Button } from "@/components/ui/button";
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from "@/components/ui/form";
import { Input } from "@/components/ui/input";
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
} from "@/components/ui/dialog";

const categorySchema = z.object({
  name: z.string().min(1, "El nombre es requerido").max(50, "Maximo 50 caracteres"),
});

type CategoryFormValues = z.infer<typeof categorySchema>;

interface CategoryFormProps {
  clinicId: Id<"clinics">;
  category?: {
    _id: Id<"serviceCategories">;
    name: string;
  };
  open: boolean;
  onOpenChange: (open: boolean) => void;
  onSuccess?: () => void;
}

export function CategoryForm({
  clinicId,
  category,
  open,
  onOpenChange,
  onSuccess,
}: CategoryFormProps) {
  const createCategory = useMutation(api.serviceCategories.create);
  const updateCategory = useMutation(api.serviceCategories.update);

  const form = useForm<CategoryFormValues>({
    resolver: zodResolver(categorySchema),
    defaultValues: {
      name: category?.name ?? "",
    },
  });

  const isEditing = !!category;

  async function onSubmit(data: CategoryFormValues) {
    try {
      if (isEditing) {
        await updateCategory({
          categoryId: category._id,
          name: data.name,
        });
        toast.success("Categoria actualizada");
      } else {
        await createCategory({
          clinicId,
          name: data.name,
        });
        toast.success("Categoria creada");
      }
      form.reset();
      onOpenChange(false);
      onSuccess?.();
    } catch (error) {
      toast.error(error instanceof Error ? error.message : "Error al guardar");
    }
  }

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent>
        <DialogHeader>
          <DialogTitle>
            {isEditing ? "Editar categoria" : "Nueva categoria"}
          </DialogTitle>
        </DialogHeader>
        <Form {...form}>
          <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
            <FormField
              control={form.control}
              name="name"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Nombre</FormLabel>
                  <FormControl>
                    <Input placeholder="Ej: Limpieza, Ortodoncia..." {...field} />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
            <div className="flex justify-end gap-2">
              <Button
                type="button"
                variant="outline"
                onClick={() => onOpenChange(false)}
              >
                Cancelar
              </Button>
              <Button type="submit" disabled={form.formState.isSubmitting}>
                {form.formState.isSubmitting
                  ? "Guardando..."
                  : isEditing
                  ? "Guardar"
                  : "Crear"}
              </Button>
            </div>
          </form>
        </Form>
      </DialogContent>
    </Dialog>
  );
}
```

Create the src/components/services directory first if it doesn't exist.
  </action>
  <verify>No TypeScript errors: `npx tsc --noEmit`</verify>
  <done>CategoryForm component handles create and edit in a dialog</done>
</task>

<task type="auto">
  <name>Task 2: Create category list component</name>
  <files>src/components/services/category-list.tsx</files>
  <action>
Create src/components/services/category-list.tsx:

```tsx
"use client";

import { useState } from "react";
import { useQuery, useMutation } from "convex/react";
import { api } from "@/convex/_generated/api";
import { Id } from "@/convex/_generated/dataModel";
import { toast } from "sonner";
import { Pencil, Trash2, Plus, FolderOpen } from "lucide-react";

import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from "@/components/ui/alert-dialog";
import { CategoryForm } from "./category-form";

// Note: AlertDialog is part of dialog component in shadcn
// If not installed separately, import from dialog or install it

interface CategoryListProps {
  clinicId: Id<"clinics">;
}

export function CategoryList({ clinicId }: CategoryListProps) {
  const categories = useQuery(api.serviceCategories.list, { clinicId });
  const removeCategory = useMutation(api.serviceCategories.remove);

  const [formOpen, setFormOpen] = useState(false);
  const [editingCategory, setEditingCategory] = useState<{
    _id: Id<"serviceCategories">;
    name: string;
  } | null>(null);
  const [deletingCategory, setDeletingCategory] = useState<{
    _id: Id<"serviceCategories">;
    name: string;
  } | null>(null);

  async function handleDelete() {
    if (!deletingCategory) return;

    try {
      await removeCategory({ categoryId: deletingCategory._id });
      toast.success("Categoria eliminada");
      setDeletingCategory(null);
    } catch (error) {
      toast.error(
        error instanceof Error
          ? error.message
          : "Error al eliminar la categoria"
      );
    }
  }

  if (categories === undefined) {
    return (
      <Card>
        <CardContent className="py-8 text-center text-muted-foreground">
          Cargando categorias...
        </CardContent>
      </Card>
    );
  }

  return (
    <>
      <Card>
        <CardHeader className="flex flex-row items-center justify-between">
          <CardTitle className="text-lg">Categorias de Servicios</CardTitle>
          <Button size="sm" onClick={() => setFormOpen(true)}>
            <Plus className="h-4 w-4 mr-1" />
            Nueva Categoria
          </Button>
        </CardHeader>
        <CardContent>
          {categories.length === 0 ? (
            <div className="text-center py-8 text-muted-foreground">
              <FolderOpen className="h-12 w-12 mx-auto mb-4 opacity-50" />
              <p>No hay categorias</p>
              <p className="text-sm mt-1">Crea una categoria para empezar</p>
            </div>
          ) : (
            <ul className="space-y-2">
              {categories.map((category) => (
                <li
                  key={category._id}
                  className="flex items-center justify-between p-3 rounded-lg border bg-card hover:bg-muted/50 transition-colors"
                >
                  <span className="font-medium">{category.name}</span>
                  <div className="flex gap-1">
                    <Button
                      variant="ghost"
                      size="icon"
                      onClick={() => {
                        setEditingCategory(category);
                        setFormOpen(true);
                      }}
                    >
                      <Pencil className="h-4 w-4" />
                    </Button>
                    <Button
                      variant="ghost"
                      size="icon"
                      onClick={() => setDeletingCategory(category)}
                    >
                      <Trash2 className="h-4 w-4 text-destructive" />
                    </Button>
                  </div>
                </li>
              ))}
            </ul>
          )}
        </CardContent>
      </Card>

      {/* Create/Edit Dialog */}
      <CategoryForm
        clinicId={clinicId}
        category={editingCategory ?? undefined}
        open={formOpen}
        onOpenChange={(open) => {
          setFormOpen(open);
          if (!open) setEditingCategory(null);
        }}
      />

      {/* Delete Confirmation */}
      <AlertDialog
        open={!!deletingCategory}
        onOpenChange={(open) => !open && setDeletingCategory(null)}
      >
        <AlertDialogContent>
          <AlertDialogHeader>
            <AlertDialogTitle>Eliminar categoria</AlertDialogTitle>
            <AlertDialogDescription>
              Â¿Estas seguro de eliminar la categoria "{deletingCategory?.name}"?
              Esta accion no se puede deshacer.
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter>
            <AlertDialogCancel>Cancelar</AlertDialogCancel>
            <AlertDialogAction
              onClick={handleDelete}
              className="bg-destructive text-destructive-foreground hover:bg-destructive/90"
            >
              Eliminar
            </AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>
    </>
  );
}
```

Note: May need to install alert-dialog from shadcn: `npx shadcn@latest add alert-dialog`
  </action>
  <verify>No TypeScript errors: `npx tsc --noEmit`</verify>
  <done>CategoryList shows categories with edit/delete actions</done>
</task>

</tasks>

<verification>
1. `cat src/components/services/category-form.tsx` shows form component
2. `cat src/components/services/category-list.tsx` shows list component
3. `npx tsc --noEmit` succeeds
</verification>

<success_criteria>
- CategoryForm handles both create and edit modes
- CategoryList shows all categories with actions
- Delete shows confirmation dialog
- Empty state shown when no categories
- Theme-aware styling (muted-foreground, destructive)
</success_criteria>

<output>
After completion, create `.planning/phases/02-professionals-services-calendar/02-14-SUMMARY.md`
</output>
