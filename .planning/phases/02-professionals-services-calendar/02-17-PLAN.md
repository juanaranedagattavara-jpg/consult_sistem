---
phase: 02-professionals-services-calendar
plan: 17
type: execute
wave: 5
depends_on: ["02-09"]
files_modified:
  - src/components/professionals/schedule-editor.tsx
autonomous: true

must_haves:
  truths:
    - "Can toggle day enabled/disabled"
    - "Can set start/end time for each day"
    - "Can optionally set lunch break"
    - "Shows inherited clinic schedule as placeholder"
  artifacts:
    - path: "src/components/professionals/schedule-editor.tsx"
      provides: "Schedule override editor"
      exports: ["ScheduleEditor"]
  key_links:
    - from: "src/components/professionals/schedule-editor.tsx"
      to: "src/components/ui/time-picker.tsx"
      via: "import TimePicker"
      pattern: "import.*TimePicker"
---

<objective>
Create schedule editor component for professional hour overrides.

Purpose: Professionals can override clinic default hours - editor shows each day with toggle, start/end times, and optional lunch.
Output: ScheduleEditor component that outputs week schedule object.
</objective>

<execution_context>
@C:\Users\juana\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\juana\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02-professionals-services-calendar/CONTEXT.md
@src/components/ui/time-picker.tsx
@src/components/ui/switch.tsx
@src/components/ui/checkbox.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create schedule editor component</name>
  <files>src/components/professionals/schedule-editor.tsx</files>
  <action>
Create src/components/professionals/schedule-editor.tsx:

```tsx
"use client";

import { useState, useEffect } from "react";
import { Switch } from "@/components/ui/switch";
import { Checkbox } from "@/components/ui/checkbox";
import { TimePicker } from "@/components/ui/time-picker";
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from "@/components/ui/card";
import { Label } from "@/components/ui/label";

// Day schedule type
interface DaySchedule {
  enabled: boolean;
  start: string;
  end: string;
  lunch?: {
    start: string;
    end: string;
  };
}

// Full week schedule type
interface WeekSchedule {
  monday?: DaySchedule;
  tuesday?: DaySchedule;
  wednesday?: DaySchedule;
  thursday?: DaySchedule;
  friday?: DaySchedule;
  saturday?: DaySchedule;
  sunday?: DaySchedule;
}

// Clinic default schedule (for placeholders)
interface ClinicSchedule {
  open: string;
  close: string;
  lunch?: {
    start: string;
    end: string;
  };
  workDays: number[]; // 0-6, Sunday = 0
}

const DAYS = [
  { key: "monday" as const, label: "Lunes", dayNum: 1 },
  { key: "tuesday" as const, label: "Martes", dayNum: 2 },
  { key: "wednesday" as const, label: "Miercoles", dayNum: 3 },
  { key: "thursday" as const, label: "Jueves", dayNum: 4 },
  { key: "friday" as const, label: "Viernes", dayNum: 5 },
  { key: "saturday" as const, label: "Sabado", dayNum: 6 },
  { key: "sunday" as const, label: "Domingo", dayNum: 0 },
];

interface ScheduleEditorProps {
  value: WeekSchedule | null;
  onChange: (schedule: WeekSchedule | null) => void;
  clinicSchedule: ClinicSchedule;
}

export function ScheduleEditor({
  value,
  onChange,
  clinicSchedule,
}: ScheduleEditorProps) {
  // Track whether we're using custom schedule
  const [useCustom, setUseCustom] = useState(!!value);

  // Initialize local state from value or clinic defaults
  const [schedule, setSchedule] = useState<WeekSchedule>(() => {
    if (value) return value;

    // Build default from clinic schedule
    const defaultSchedule: WeekSchedule = {};
    for (const day of DAYS) {
      const isWorkDay = clinicSchedule.workDays.includes(day.dayNum);
      defaultSchedule[day.key] = {
        enabled: isWorkDay,
        start: clinicSchedule.open,
        end: clinicSchedule.close,
        lunch: clinicSchedule.lunch
          ? { start: clinicSchedule.lunch.start, end: clinicSchedule.lunch.end }
          : undefined,
      };
    }
    return defaultSchedule;
  });

  // Sync value changes to parent
  useEffect(() => {
    if (useCustom) {
      onChange(schedule);
    } else {
      onChange(null);
    }
  }, [schedule, useCustom, onChange]);

  const updateDay = (
    dayKey: keyof WeekSchedule,
    updates: Partial<DaySchedule>
  ) => {
    setSchedule((prev) => ({
      ...prev,
      [dayKey]: { ...prev[dayKey]!, ...updates },
    }));
  };

  const toggleLunch = (dayKey: keyof WeekSchedule, enabled: boolean) => {
    setSchedule((prev) => ({
      ...prev,
      [dayKey]: {
        ...prev[dayKey]!,
        lunch: enabled
          ? { start: clinicSchedule.lunch?.start || "13:00", end: clinicSchedule.lunch?.end || "14:00" }
          : undefined,
      },
    }));
  };

  return (
    <Card>
      <CardHeader>
        <div className="flex items-center justify-between">
          <div>
            <CardTitle className="text-lg">Horario de Atencion</CardTitle>
            <CardDescription>
              {useCustom
                ? "Horario personalizado para este profesional"
                : "Usando horario de la clinica"}
            </CardDescription>
          </div>
          <div className="flex items-center gap-2">
            <Label htmlFor="custom-schedule" className="text-sm text-muted-foreground">
              Personalizar
            </Label>
            <Switch
              id="custom-schedule"
              checked={useCustom}
              onCheckedChange={setUseCustom}
            />
          </div>
        </div>
      </CardHeader>
      <CardContent className={!useCustom ? "opacity-50 pointer-events-none" : ""}>
        <div className="space-y-4">
          {DAYS.map((day) => {
            const daySchedule = schedule[day.key];
            const isWorkDay = daySchedule?.enabled ?? false;

            return (
              <div
                key={day.key}
                className="flex items-start gap-4 p-3 rounded-lg border bg-card"
              >
                {/* Day Toggle */}
                <div className="flex items-center gap-2 min-w-[120px]">
                  <Checkbox
                    id={`${day.key}-enabled`}
                    checked={isWorkDay}
                    onCheckedChange={(checked) =>
                      updateDay(day.key, { enabled: !!checked })
                    }
                    disabled={!useCustom}
                  />
                  <Label
                    htmlFor={`${day.key}-enabled`}
                    className={!isWorkDay ? "text-muted-foreground" : ""}
                  >
                    {day.label}
                  </Label>
                </div>

                {/* Time Pickers */}
                {isWorkDay && (
                  <div className="flex flex-wrap items-center gap-4">
                    <div className="flex items-center gap-2">
                      <span className="text-sm text-muted-foreground">Inicio:</span>
                      <TimePicker
                        value={daySchedule?.start || "09:00"}
                        onChange={(start) => updateDay(day.key, { start })}
                        disabled={!useCustom}
                      />
                    </div>
                    <div className="flex items-center gap-2">
                      <span className="text-sm text-muted-foreground">Fin:</span>
                      <TimePicker
                        value={daySchedule?.end || "18:00"}
                        onChange={(end) => updateDay(day.key, { end })}
                        disabled={!useCustom}
                      />
                    </div>

                    {/* Lunch Toggle */}
                    <div className="flex items-center gap-2 ml-4">
                      <Checkbox
                        id={`${day.key}-lunch`}
                        checked={!!daySchedule?.lunch}
                        onCheckedChange={(checked) =>
                          toggleLunch(day.key, !!checked)
                        }
                        disabled={!useCustom}
                      />
                      <Label
                        htmlFor={`${day.key}-lunch`}
                        className="text-sm text-muted-foreground"
                      >
                        Almuerzo
                      </Label>

                      {daySchedule?.lunch && (
                        <>
                          <TimePicker
                            value={daySchedule.lunch.start}
                            onChange={(start) =>
                              updateDay(day.key, {
                                lunch: { ...daySchedule.lunch!, start },
                              })
                            }
                            disabled={!useCustom}
                          />
                          <span className="text-muted-foreground">-</span>
                          <TimePicker
                            value={daySchedule.lunch.end}
                            onChange={(end) =>
                              updateDay(day.key, {
                                lunch: { ...daySchedule.lunch!, end },
                              })
                            }
                            disabled={!useCustom}
                          />
                        </>
                      )}
                    </div>
                  </div>
                )}

                {!isWorkDay && (
                  <span className="text-sm text-muted-foreground italic">
                    No trabaja
                  </span>
                )}
              </div>
            );
          })}
        </div>
      </CardContent>
    </Card>
  );
}
```

Key features:
- Toggle between clinic default and custom schedule
- Per-day enabled/disabled checkbox
- Start/end time pickers for each day
- Optional lunch break per day
- Grayed out when using clinic defaults
- Returns null when using clinic defaults, WeekSchedule when custom
  </action>
  <verify>No TypeScript errors: `npx tsc --noEmit`</verify>
  <done>ScheduleEditor component handles day-by-day schedule override</done>
</task>

</tasks>

<verification>
1. `cat src/components/professionals/schedule-editor.tsx` shows component
2. `npx tsc --noEmit` succeeds
3. Component uses TimePicker, Switch, Checkbox from shadcn
</verification>

<success_criteria>
- Toggle between clinic default and custom schedule
- Each day has enabled checkbox, start/end times
- Optional lunch break per day
- Returns null when using clinic defaults
- Visual indication of custom vs default mode
</success_criteria>

<output>
After completion, create `.planning/phases/02-professionals-services-calendar/02-17-SUMMARY.md`
</output>
