---
phase: 02-professionals-services-calendar
plan: 25
type: execute
wave: 8
depends_on: ["02-19", "02-22", "02-24"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Services page renders correctly with categories"
    - "Professionals page has working view toggle"
    - "Professional form creates/edits successfully"
    - "API endpoints respond correctly"
---

<objective>
Human verification of Phase 2 implementation.

Purpose: Validate that all CRUD operations, UI components, and API endpoints work as expected before marking phase complete.
Output: Verification that all Phase 2 requirements are met.
</objective>

<execution_context>
@C:\Users\juana\.claude/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02-professionals-services-calendar/CONTEXT.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete Phase 2: Professionals, Services, and Availability API

    Features implemented:
    1. Service categories CRUD with drag-drop ordering
    2. Services CRUD with category grouping, duplicate, active toggle
    3. Professionals CRUD with service multi-select, color, email validation
    4. Professional schedule override (inherits from clinic or custom)
    5. Calendar selector (mock for now, ready for n8n integration)
    6. Professional exceptions (vacations) management
    7. Availability calculation (schedule + exceptions + appointments)
    8. HTTP API endpoints for n8n (professionals, services, categories, availability)
  </what-built>
  <how-to-verify>
    Start the dev server if not running:
    ```bash
    npm run dev
    ```

    **1. Services Page (/servicios)**
    - [ ] Create a service category (e.g., "Limpieza")
    - [ ] Create a service in that category with duration and price
    - [ ] Duplicate the service (should append "(copia)")
    - [ ] Toggle service active/inactive
    - [ ] Drag-drop to reorder services
    - [ ] Edit service, change category
    - [ ] Delete service (confirm dialog appears)

    **2. Professionals Page (/profesionales)**
    - [ ] Toggle between table and cards view
    - [ ] Filter by active/inactive/all
    - [ ] Create new professional with all fields
    - [ ] Multi-select services works
    - [ ] Color picker works
    - [ ] Edit professional (tabs work: Datos, Horario, Calendar)
    - [ ] Schedule editor: toggle custom vs clinic default
    - [ ] Calendar selector shows instructions and mock calendars
    - [ ] Bulk select + activate/deactivate in table view
    - [ ] Delete professional (confirm dialog appears)

    **3. HTTP API (use curl or Postman)**
    First, generate an API key for the clinic:
    - In Convex dashboard, run clinics.generateApiKey({ clinicId: "your-clinic-id" })

    Then test endpoints:
    ```bash
    # Replace YOUR_API_KEY and YOUR_CONVEX_URL
    curl -H "X-API-Key: YOUR_API_KEY" https://YOUR_CONVEX_URL/api/professionals
    curl -H "X-API-Key: YOUR_API_KEY" https://YOUR_CONVEX_URL/api/services
    curl -H "X-API-Key: YOUR_API_KEY" https://YOUR_CONVEX_URL/api/categories
    curl -H "X-API-Key: YOUR_API_KEY" "https://YOUR_CONVEX_URL/api/availability?professionalId=XXX&serviceId=XXX&date=2026-02-05"
    ```
    - [ ] All endpoints return proper JSON with success: true
    - [ ] Availability returns slots array

    **4. Edge Cases**
    - [ ] Try creating professional with duplicate email (should error)
    - [ ] Try deleting category with services (should error)
    - [ ] Create professional exception (vacation) - should block availability
  </how-to-verify>
  <resume-signal>
    Type "approved" if all checks pass, or describe any issues found.
  </resume-signal>
</task>

</tasks>

<verification>
Phase 2 requirements checklist:
- PROF-01: CRUD profesionales - verified in UI
- PROF-02: All fields - name, email, phone, specialty, services, color
- PROF-03: Calendar ID selection (mock) - verified in calendar selector
- PROF-04: N/A (n8n has OAuth, no tokens stored)
- PROF-05: Schedule override - verified in schedule editor
- PROF-06: Exceptions CRUD - verified
- PROF-07: Active/inactive toggle - verified
- SERV-01: CRUD services - verified
- SERV-02: All fields - name, description, duration, price, category, color
- SERV-03: Instructions pre-cita - deferred to Phase 3 appointment wizard
- SERV-04: Multi-select professionals - reversed (professionals select services)
- SERV-05: Active/inactive toggle - verified
- AVAI-01: API returns available slots - verified
- AVAI-02: Considers professional schedule - verified in algorithm
- AVAI-03: Considers Google Calendar - placeholder (n8n integration pending)
- AVAI-04: Considers exceptions - verified in algorithm
- AVAI-05: Considers service duration - verified in algorithm
</verification>

<success_criteria>
All manual verification steps pass.
</success_criteria>

<output>
After completion, create `.planning/phases/02-professionals-services-calendar/02-25-SUMMARY.md`
</output>
