---
phase: 01-foundation-auth-onboarding
plan: 29
type: execute
wave: 14
depends_on: ["01-22"]
files_modified: [convex/dashboard.ts, src/hooks/use-current-clinic.ts]
autonomous: true
must_haves:
  truths:
    - "getStats query returns dashboard data"
  artifacts:
    - path: "convex/dashboard.ts"
      exports: ["getStats"]
    - path: "src/hooks/use-current-clinic.ts"
      exports: ["useCurrentClinic"]
---

<objective>
Create dashboard queries and current clinic hook.

Purpose: Backend data for dashboard.
Output: Stats query and clinic hook.
</objective>

<tasks>

<task type="auto">
  <name>Create dashboard queries</name>
  <files>convex/dashboard.ts, src/hooks/use-current-clinic.ts</files>
  <action>
  1. Create convex/dashboard.ts:
  ```typescript
  import { query } from "./_generated/server";

  export const getStats = query({
    handler: async (ctx) => {
      const identity = await ctx.auth.getUserIdentity();
      if (!identity) return null;

      // Find user
      const user = await ctx.db
        .query("users")
        .withIndex("by_email", (q) => q.eq("email", identity.email!))
        .first();

      if (!user) return null;

      // For Phase 1, return placeholder stats
      // These will be calculated from real data in Phase 3
      return {
        appointmentsToday: 0,
        appointmentsWeek: 0,
        confirmationRate: 0,
        hoursRecovered: 0,
      };
    },
  });
  ```

  2. Create src/hooks/use-current-clinic.ts:
  ```typescript
  import { useQuery } from "convex/react";
  import { api } from "../../convex/_generated/api";

  export function useCurrentClinic() {
    const user = useQuery(api.users.getCurrentUser);

    return {
      clinic: user?.clinic || null,
      isLoading: user === undefined,
      user: user || null,
    };
  }
  ```
  </action>
  <verify>Queries return data correctly</verify>
  <done>Dashboard queries ready</done>
</task>

</tasks>

<verification>
- [ ] getStats returns object with stats
- [ ] useCurrentClinic returns clinic data
</verification>

<success_criteria>
- Dashboard backend ready
- Hooks work correctly
</success_criteria>

<output>
Create `.planning/phases/01-foundation-auth-onboarding/01-29-SUMMARY.md`
</output>
