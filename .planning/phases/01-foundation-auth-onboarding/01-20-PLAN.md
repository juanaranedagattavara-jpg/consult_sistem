---
phase: 01-foundation-auth-onboarding
plan: 20
type: execute
wave: 10
depends_on: ["01-15", "01-16"]
files_modified: [src/components/onboarding/step-5-setup.tsx]
autonomous: true
must_haves:
  truths:
    - "Step 5 creates first professional and service"
  artifacts:
    - path: "src/components/onboarding/step-5-setup.tsx"
      min_lines: 70
---

<objective>
Create onboarding step 5 for initial setup.

Purpose: Create first professional and service.
Output: Setup step that completes onboarding.
</objective>

<tasks>

<task type="auto">
  <name>Create step 5 setup</name>
  <files>src/components/onboarding/step-5-setup.tsx</files>
  <action>
  Create src/components/onboarding/step-5-setup.tsx:

  ```typescript
  "use client";

  import { useState } from "react";
  import { useForm } from "react-hook-form";
  import { zodResolver } from "@hookform/resolvers/zod";
  import { useMutation } from "convex/react";
  import { api } from "../../../convex/_generated/api";
  import { useRouter } from "next/navigation";
  import { useOnboardingStore } from "@/lib/stores/onboarding-store";
  import { setupSchema, SetupInput } from "@/lib/validators/onboarding";
  import { Button } from "@/components/ui/button";
  import { Input } from "@/components/ui/input";
  import { Label } from "@/components/ui/label";
  import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
  import { toast } from "sonner";

  const DURATIONS = [
    { value: 15, label: "15 minutos" },
    { value: 30, label: "30 minutos" },
    { value: 45, label: "45 minutos" },
    { value: 60, label: "1 hora" },
  ];

  interface Step5Props {
    onBack: () => void;
  }

  export function Step5Setup({ onBack }: Step5Props) {
    const router = useRouter();
    const { data, setStepData, reset } = useOnboardingStore();
    const [loading, setLoading] = useState(false);

    // This mutation will be created in the next plan
    // const completeOnboarding = useMutation(api.clinics.completeOnboarding);

    const form = useForm<SetupInput>({
      resolver: zodResolver(setupSchema),
      defaultValues: data.setup || {
        professionalName: "",
        serviceName: "",
        serviceDuration: 30,
      },
    });

    const onSubmit = async (values: SetupInput) => {
      setLoading(true);
      setStepData("setup", values);

      try {
        // Collect all data from store
        const allData = {
          ...data,
          setup: values,
        };

        // For now, just show success
        // completeOnboarding will be called when mutation is ready
        toast.success("¡Configuración completada!");
        reset();
        router.push("/dashboard");
      } catch (error: any) {
        toast.error(error.message || "Error al completar");
      } finally {
        setLoading(false);
      }
    };

    return (
      <Card>
        <CardHeader>
          <CardTitle>Configuración inicial</CardTitle>
          <CardDescription>Crea tu primer profesional y servicio</CardDescription>
        </CardHeader>
        <CardContent>
          <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-6">
            <div>
              <Label htmlFor="professionalName">Nombre del profesional</Label>
              <Input
                {...form.register("professionalName")}
                id="professionalName"
                placeholder="Dr. Juan Pérez"
                className="mt-2"
              />
              {form.formState.errors.professionalName && (
                <p className="text-sm text-red-500">{form.formState.errors.professionalName.message}</p>
              )}
            </div>

            <div>
              <Label htmlFor="serviceName">Nombre del servicio</Label>
              <Input
                {...form.register("serviceName")}
                id="serviceName"
                placeholder="Consulta general"
                className="mt-2"
              />
              {form.formState.errors.serviceName && (
                <p className="text-sm text-red-500">{form.formState.errors.serviceName.message}</p>
              )}
            </div>

            <div>
              <Label>Duración del servicio</Label>
              <div className="grid grid-cols-4 gap-2 mt-2">
                {DURATIONS.map((duration) => (
                  <button
                    key={duration.value}
                    type="button"
                    onClick={() => form.setValue("serviceDuration", duration.value)}
                    className={`p-2 rounded-lg border text-sm ${
                      form.watch("serviceDuration") === duration.value
                        ? "bg-primary text-primary-foreground border-primary"
                        : "bg-white hover:bg-gray-50"
                    }`}
                  >
                    {duration.label}
                  </button>
                ))}
              </div>
            </div>

            <div className="flex gap-2">
              <Button type="button" variant="outline" onClick={onBack} className="flex-1">
                Atrás
              </Button>
              <Button type="submit" className="flex-1" disabled={loading}>
                {loading ? "Completando..." : "Completar"}
              </Button>
            </div>
          </form>
        </CardContent>
      </Card>
    );
  }
  ```
  </action>
  <verify>Component renders and form validates</verify>
  <done>Step 5 ready</done>
</task>

</tasks>

<verification>
- [ ] Professional name input works
- [ ] Service name input works
- [ ] Duration selection works
- [ ] Submit triggers completion
</verification>

<success_criteria>
- Setup step complete
- Form validates
- Ready for mutation integration
</success_criteria>

<output>
Create `.planning/phases/01-foundation-auth-onboarding/01-20-SUMMARY.md`
</output>
