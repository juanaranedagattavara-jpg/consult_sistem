---
phase: 01-foundation-auth-onboarding
plan: 08
type: execute
wave: 5
depends_on: ["01-03"]
files_modified: [convex/files.ts]
autonomous: true
must_haves:
  truths:
    - "generateUploadUrl mutation exists"
  artifacts:
    - path: "convex/files.ts"
      exports: ["generateUploadUrl", "getFileUrl"]
---

<objective>
Create Convex mutations for file storage operations.

Purpose: Enable file uploads for logos and avatars.
Output: File storage mutations deployed.
</objective>

<tasks>

<task type="auto">
  <name>Create file storage mutations</name>
  <files>convex/files.ts</files>
  <action>
  Create convex/files.ts:

  ```typescript
  import { mutation, query } from "./_generated/server";
  import { v } from "convex/values";

  export const generateUploadUrl = mutation({
    handler: async (ctx) => {
      return await ctx.storage.generateUploadUrl();
    },
  });

  export const getFileUrl = query({
    args: { storageId: v.id("_storage") },
    handler: async (ctx, args) => {
      return await ctx.storage.getUrl(args.storageId);
    },
  });

  export const deleteFile = mutation({
    args: { storageId: v.id("_storage") },
    handler: async (ctx, args) => {
      await ctx.storage.delete(args.storageId);
    },
  });
  ```

  Run npx convex dev to deploy.
  </action>
  <verify>npx convex dev shows mutations deployed</verify>
  <done>File storage mutations ready</done>
</task>

</tasks>

<verification>
- [ ] convex/files.ts exists
- [ ] generateUploadUrl mutation works
- [ ] getFileUrl query works
</verification>

<success_criteria>
- File mutations deployed
- Can generate upload URLs
</success_criteria>

<output>
Create `.planning/phases/01-foundation-auth-onboarding/01-08-SUMMARY.md`
</output>
