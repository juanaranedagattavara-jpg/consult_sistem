---
phase: 01-foundation-auth-onboarding
plan: 34
type: execute
wave: 16
depends_on: ["01-30", "01-31"]
files_modified: [src/app/(dashboard)/layout.tsx]
autonomous: true
must_haves:
  truths:
    - "Dashboard layout has header and nav"
    - "White label colors applied"
  artifacts:
    - path: "src/app/(dashboard)/layout.tsx"
      min_lines: 50
---

<objective>
Create dashboard layout with header and navigation.

Purpose: Shell for all dashboard pages.
Output: Responsive layout with auth protection.
</objective>

<tasks>

<task type="auto">
  <name>Create dashboard layout</name>
  <files>src/app/(dashboard)/layout.tsx</files>
  <action>
  Create src/app/(dashboard)/layout.tsx:

  ```typescript
  "use client";

  import { useState, useEffect } from "react";
  import { useRouter } from "next/navigation";
  import { useQuery } from "convex/react";
  import { api } from "../../../convex/_generated/api";
  import { Header } from "@/components/dashboard/header";
  import { Nav } from "@/components/dashboard/nav";

  export default function DashboardLayout({
    children,
  }: {
    children: React.ReactNode;
  }) {
    const router = useRouter();
    const user = useQuery(api.users.getCurrentUser);
    const [navOpen, setNavOpen] = useState(false);

    // Auth check
    useEffect(() => {
      if (user === null) {
        router.push("/login");
      } else if (user && !user.clinic?.onboardingCompleted) {
        router.push("/onboarding");
      }
    }, [user, router]);

    // Apply white label colors
    useEffect(() => {
      if (user?.clinic?.colors) {
        document.documentElement.style.setProperty(
          "--primary",
          user.clinic.colors.primary
        );
        document.documentElement.style.setProperty(
          "--secondary",
          user.clinic.colors.secondary
        );
      }
    }, [user?.clinic?.colors]);

    // Loading state
    if (user === undefined) {
      return (
        <div className="min-h-screen flex items-center justify-center">
          <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary" />
        </div>
      );
    }

    // Not authenticated
    if (user === null) {
      return null;
    }

    return (
      <div className="min-h-screen bg-gray-50">
        <Header onMenuToggle={() => setNavOpen(!navOpen)} />
        <Nav isOpen={navOpen} onClose={() => setNavOpen(false)} />
        <main className="lg:ml-0">
          {children}
        </main>
      </div>
    );
  }
  ```
  </action>
  <verify>Layout renders with header and nav</verify>
  <done>Dashboard layout ready</done>
</task>

</tasks>

<verification>
- [ ] Auth protection works
- [ ] Redirects to onboarding if needed
- [ ] White label colors apply
- [ ] Responsive layout works
</verification>

<success_criteria>
- Layout functional
- Auth protection working
- White label applied
</success_criteria>

<output>
Create `.planning/phases/01-foundation-auth-onboarding/01-34-SUMMARY.md`
</output>
