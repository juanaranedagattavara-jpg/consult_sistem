---
phase: 01-foundation-auth-onboarding
plan: 23
type: execute
wave: 12
depends_on: ["01-09"]
files_modified: [src/components/settings/clinic-form.tsx]
autonomous: true
must_haves:
  truths:
    - "Clinic form updates general settings"
  artifacts:
    - path: "src/components/settings/clinic-form.tsx"
      min_lines: 60
---

<objective>
Create clinic general settings form component.

Purpose: Edit basic clinic information.
Output: Form for name, RUT, address, phone.
</objective>

<tasks>

<task type="auto">
  <name>Create clinic form</name>
  <files>src/components/settings/clinic-form.tsx</files>
  <action>
  Create src/components/settings/clinic-form.tsx:

  ```typescript
  "use client";

  import { useForm } from "react-hook-form";
  import { zodResolver } from "@hookform/resolvers/zod";
  import { useMutation, useQuery } from "convex/react";
  import { api } from "../../../convex/_generated/api";
  import { z } from "zod";
  import { Button } from "@/components/ui/button";
  import { Input } from "@/components/ui/input";
  import { Label } from "@/components/ui/label";
  import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
  import { toast } from "sonner";

  const clinicSchema = z.object({
    name: z.string().min(2, "Nombre requerido"),
    taxId: z.string().min(8, "RUT inválido"),
    address: z.string().min(5, "Dirección requerida"),
    phone: z.string().min(9, "Teléfono inválido"),
    email: z.string().email("Email inválido"),
  });

  type ClinicFormData = z.infer<typeof clinicSchema>;

  export function ClinicForm() {
    const user = useQuery(api.users.getCurrentUser);
    const updateClinic = useMutation(api.clinics.updateClinicGeneral);

    const form = useForm<ClinicFormData>({
      resolver: zodResolver(clinicSchema),
      defaultValues: {
        name: user?.clinic?.name || "",
        taxId: user?.clinic?.taxId || "",
        address: user?.clinic?.address || "",
        phone: user?.clinic?.phone || "",
        email: user?.clinic?.email || "",
      },
    });

    const onSubmit = async (data: ClinicFormData) => {
      try {
        await updateClinic({
          clinicId: user!.clinicId,
          ...data,
        });
        toast.success("Datos actualizados");
      } catch (error: any) {
        toast.error(error.message || "Error al guardar");
      }
    };

    if (!user) return <div>Cargando...</div>;

    return (
      <Card>
        <CardHeader>
          <CardTitle>Información general</CardTitle>
        </CardHeader>
        <CardContent>
          <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
            <div>
              <Label htmlFor="name">Nombre de la clínica</Label>
              <Input {...form.register("name")} id="name" />
              {form.formState.errors.name && (
                <p className="text-sm text-red-500">{form.formState.errors.name.message}</p>
              )}
            </div>
            <div>
              <Label htmlFor="taxId">RUT</Label>
              <Input {...form.register("taxId")} id="taxId" />
            </div>
            <div>
              <Label htmlFor="address">Dirección</Label>
              <Input {...form.register("address")} id="address" />
            </div>
            <div>
              <Label htmlFor="phone">Teléfono</Label>
              <Input {...form.register("phone")} id="phone" />
            </div>
            <div>
              <Label htmlFor="email">Email</Label>
              <Input {...form.register("email")} id="email" type="email" />
            </div>
            <Button type="submit" disabled={form.formState.isSubmitting}>
              {form.formState.isSubmitting ? "Guardando..." : "Guardar"}
            </Button>
          </form>
        </CardContent>
      </Card>
    );
  }
  ```
  </action>
  <verify>Form renders and submits</verify>
  <done>Clinic form ready</done>
</task>

</tasks>

<verification>
- [ ] Form pre-fills with current data
- [ ] Validation works
- [ ] Submit updates database
</verification>

<success_criteria>
- Form functional
- Toast feedback
- Data persists
</success_criteria>

<output>
Create `.planning/phases/01-foundation-auth-onboarding/01-23-SUMMARY.md`
</output>
