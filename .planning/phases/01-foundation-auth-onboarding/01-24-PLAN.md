---
phase: 01-foundation-auth-onboarding
plan: 24
type: execute
wave: 12
depends_on: ["01-09"]
files_modified: [src/components/settings/bot-config-form.tsx]
autonomous: true
must_haves:
  truths:
    - "Bot config form updates tone and messages"
  artifacts:
    - path: "src/components/settings/bot-config-form.tsx"
      min_lines: 100
---

<objective>
Create bot configuration form component.

Purpose: Configure WhatsApp bot settings.
Output: Form for tone, prompts, FAQs, messages.
</objective>

<tasks>

<task type="auto">
  <name>Create bot config form</name>
  <files>src/components/settings/bot-config-form.tsx</files>
  <action>
  Create src/components/settings/bot-config-form.tsx:

  ```typescript
  "use client";

  import { useState } from "react";
  import { useForm, useFieldArray } from "react-hook-form";
  import { useMutation, useQuery } from "convex/react";
  import { api } from "../../../convex/_generated/api";
  import { Button } from "@/components/ui/button";
  import { Input } from "@/components/ui/input";
  import { Label } from "@/components/ui/label";
  import { Textarea } from "@/components/ui/textarea";
  import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
  import { toast } from "sonner";
  import { Plus, Trash2 } from "lucide-react";

  interface BotConfigData {
    tone: "formal" | "casual" | "amigable";
    customPrompts: string;
    faqs: { question: string; answer: string }[];
    welcomeMessage: string;
    afterHoursMessage: string;
  }

  export function BotConfigForm() {
    const user = useQuery(api.users.getCurrentUser);
    const updateBot = useMutation(api.clinics.updateClinicBot);

    const form = useForm<BotConfigData>({
      defaultValues: {
        tone: user?.clinic?.botConfig?.tone || "amigable",
        customPrompts: user?.clinic?.botConfig?.customPrompts || "",
        faqs: user?.clinic?.botConfig?.faqs || [],
        welcomeMessage: user?.clinic?.botConfig?.welcomeMessage || "",
        afterHoursMessage: user?.clinic?.botConfig?.afterHoursMessage || "",
      },
    });

    const { fields, append, remove } = useFieldArray({
      control: form.control,
      name: "faqs",
    });

    const onSubmit = async (data: BotConfigData) => {
      try {
        await updateBot({
          clinicId: user!.clinicId,
          botConfig: data,
        });
        toast.success("Configuración del bot actualizada");
      } catch (error: any) {
        toast.error(error.message || "Error al guardar");
      }
    };

    if (!user) return <div>Cargando...</div>;

    return (
      <Card>
        <CardHeader>
          <CardTitle>Configuración del Bot</CardTitle>
        </CardHeader>
        <CardContent>
          <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-6">
            <div>
              <Label>Tono del bot</Label>
              <div className="flex gap-2 mt-2">
                {(["formal", "casual", "amigable"] as const).map((tone) => (
                  <button
                    key={tone}
                    type="button"
                    onClick={() => form.setValue("tone", tone)}
                    className={`px-4 py-2 rounded-lg border capitalize ${
                      form.watch("tone") === tone
                        ? "bg-primary text-white border-primary"
                        : "bg-white hover:bg-gray-50"
                    }`}
                  >
                    {tone}
                  </button>
                ))}
              </div>
            </div>

            <div>
              <Label htmlFor="welcomeMessage">Mensaje de bienvenida</Label>
              <Textarea
                {...form.register("welcomeMessage")}
                id="welcomeMessage"
                rows={3}
                className="mt-2"
              />
            </div>

            <div>
              <Label htmlFor="afterHoursMessage">Mensaje fuera de horario</Label>
              <Textarea
                {...form.register("afterHoursMessage")}
                id="afterHoursMessage"
                rows={3}
                className="mt-2"
              />
            </div>

            <div>
              <Label htmlFor="customPrompts">Instrucciones personalizadas</Label>
              <Textarea
                {...form.register("customPrompts")}
                id="customPrompts"
                rows={4}
                placeholder="Instrucciones adicionales para el bot..."
                className="mt-2"
              />
            </div>

            <div>
              <div className="flex justify-between items-center mb-2">
                <Label>Preguntas frecuentes</Label>
                <Button
                  type="button"
                  variant="outline"
                  size="sm"
                  onClick={() => append({ question: "", answer: "" })}
                >
                  <Plus className="w-4 h-4 mr-1" /> Agregar
                </Button>
              </div>
              <div className="space-y-4">
                {fields.map((field, index) => (
                  <div key={field.id} className="border rounded-lg p-4">
                    <div className="flex justify-between mb-2">
                      <span className="text-sm font-medium">FAQ {index + 1}</span>
                      <button type="button" onClick={() => remove(index)}>
                        <Trash2 className="w-4 h-4 text-red-500" />
                      </button>
                    </div>
                    <Input
                      {...form.register(`faqs.${index}.question`)}
                      placeholder="Pregunta"
                      className="mb-2"
                    />
                    <Textarea
                      {...form.register(`faqs.${index}.answer`)}
                      placeholder="Respuesta"
                      rows={2}
                    />
                  </div>
                ))}
              </div>
            </div>

            <Button type="submit" disabled={form.formState.isSubmitting}>
              {form.formState.isSubmitting ? "Guardando..." : "Guardar"}
            </Button>
          </form>
        </CardContent>
      </Card>
    );
  }
  ```

  Note: First install Textarea component: npx shadcn@latest add textarea
  </action>
  <verify>Form renders with all fields</verify>
  <done>Bot config form ready</done>
</task>

</tasks>

<verification>
- [ ] Tone selection works
- [ ] FAQ list is dynamic
- [ ] Submit updates database
</verification>

<success_criteria>
- Bot config form functional
- FAQ add/remove works
- Data persists
</success_criteria>

<output>
Create `.planning/phases/01-foundation-auth-onboarding/01-24-SUMMARY.md`
</output>
